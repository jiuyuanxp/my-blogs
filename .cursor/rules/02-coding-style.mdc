---
description: 通用代码风格 - 不可变性、文件组织、错误处理
alwaysApply: true
---

# 代码风格

## 不可变性（关键）

始终创建新对象，绝不原地修改：

```
WRONG:  modify(original, field, value) → 原地修改
CORRECT: update(original, field, value) → 返回新副本
```

## 文件组织

小文件优于大文件：
- 高内聚、低耦合
- 典型 200–400 行，最大 800 行
- 按功能/领域组织，而非按类型

## 错误处理

- 每一层显式处理错误
- UI 层提供用户友好提示
- 服务端记录详细错误上下文
- 绝不静默吞掉错误

## 输入校验

- 在系统边界校验所有用户输入
- 优先使用 schema 校验（如 Zod）
- 快速失败，给出清晰错误信息
- 不信任外部数据（API、用户输入、文件内容）

## 完成前检查

- [ ] 命名清晰、可读
- [ ] 函数短小（<50 行）
- [ ] 文件聚焦（<800 行）
- [ ] 无深层嵌套（>4 层）
- [ ] 错误处理完善
- [ ] 无魔法数字（用常量或配置）
- [ ] 使用不可变模式

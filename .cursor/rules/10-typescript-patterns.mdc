---
description: TypeScript/React 代码风格与模式
globs: "**/*.ts,**/*.tsx,**/*.js,**/*.jsx"
alwaysApply: false
---

# TypeScript/JavaScript 规范

## 不可变性

使用展开运算符做不可变更新：

```typescript
// WRONG
function updateUser(user, name) {
  user.name = name
  return user
}

// CORRECT
function updateUser(user, name) {
  return { ...user, name }
}
```

## 错误处理

使用 async/await + try-catch：

```typescript
try {
  const result = await riskyOperation()
  return result
} catch (error) {
  logger.error('Operation failed:', error)
  throw new Error('Detailed user-friendly message')
}
```

## 输入校验

使用 Zod 做 schema 校验：

```typescript
import { z } from 'zod'

const schema = z.object({
  email: z.string().email(),
  age: z.number().int().min(0).max(150)
})
const validated = schema.parse(input)
```

## Console.log

- 生产代码禁止 `console.log`
- 使用日志库（如 pino、winston）

## API 响应格式

```typescript
interface ApiResponse<T> {
  success: boolean
  data?: T
  error?: string
  meta?: { total: number; page: number; limit: number }
}
```

## E2E 测试

关键用户流程使用 **Playwright** 做 E2E 测试。
